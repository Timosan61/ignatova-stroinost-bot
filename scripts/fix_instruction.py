#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–æ—Ç–∞-–∫—É—Ä–∞—Ç–æ—Ä–∞
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. Placeholder [–ò–º—è] ‚Üí –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–º—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã" (—Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π / —Ç–æ—á–∫–∞)
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–æ –∞–Ω–∞–ª–∏–∑ –ø—É–Ω–∫—Ç–æ–≤ 1 –∏ 2 –º–æ–∑–≥–æ—Ä–∏—Ç–º–∞
"""

import json
import re

def fix_instruction_text(text: str) -> str:
    """–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"""

    # ===== 1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–ó–î–ï–õ–ê –ü–†–û –ò–ú–Ø =====

    # –ù–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª "–í–°–ï–ì–î–ê –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏ —É—á–µ–Ω–∏—Ü—ã"
    old_name_section = '''**–í–°–ï–ì–î–ê –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏ —É—á–µ–Ω–∏—Ü—ã**

- –§–æ—Ä–º–∞—Ç: "[–ò–º—è], [—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞]"
- –ü—Ä–∏–º–µ—Ä—ã: "–°–≤–µ—Ç–ª–∞–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏:
  - –ò–∑ Telegram –ø—Ä–æ—Ñ–∏–ª—è (first_name)
  - –ò–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–∞ (–µ—Å–ª–∏ —É—á–µ–Ω–∏—Ü–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å)
  - –ï–°–õ–ò –∏–º—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ: "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏" (–±–µ–∑ –∏–º–µ–Ω–∏)'''

    new_name_section = '''**–í–°–ï–ì–î–ê –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏ —É—á–µ–Ω–∏—Ü—ã (–†–ï–ê–õ–¨–ù–û–ú–£!)**

**–ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏:**

1. **–ò–∑–≤–ª–µ—á—å –∏–º—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞:**
   - –ö—É—Ä–∞—Ç–æ—Ä –ø–∏—à–µ—Ç: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∑–≥–æ—Ä–∏—Ç–º –ï–ª–∏–∑–∞–≤–µ—Ç—ã: [—Ç–µ–∫—Å—Ç]" ‚Üí –∏–º—è: –ï–ª–∏–∑–∞–≤–µ—Ç–∞
   - –ö—É—Ä–∞—Ç–æ—Ä –ø–∏—à–µ—Ç: "–ü–æ–º–æ–≥–∏ —Å –º–æ–∑–≥–æ—Ä–∏—Ç–º–æ–º –°–≤–µ—Ç–ª–∞–Ω—ã" ‚Üí –∏–º—è: –°–≤–µ—Ç–ª–∞–Ω–∞ (—Ä–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –∏–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π)
   - –ö—É—Ä–∞—Ç–æ—Ä –ø–∏—à–µ—Ç: "–ï–ª–µ–Ω–∞ –ø—Ä–∏—Å–ª–∞–ª–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º" ‚Üí –∏–º—è: –ï–ª–µ–Ω–∞

2. **–ï—Å–ª–∏ –∏–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –ø—Ä–æ—Ñ–∏–ª—å ‚Üí first_name (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–≤–µ—Ç–ª–∞–Ω–∞")
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞ ‚Üí "–ú–µ–Ω—è –∑–æ–≤—É—Ç..." (–µ—Å–ª–∏ –µ—Å—Ç—å)

3. **–ï–°–õ–ò –∏–º—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ:**
   - –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å placeholder "[–ò–º—è]"!
   - –ù–∞—á–∞—Ç—å –±–µ–∑ –∏–º–µ–Ω–∏: "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: "–°–≤–µ—Ç–ª–∞–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"
- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: "–¢–∞—Ç—å—è–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –º–æ–∑–≥–æ—Ä–∏—Ç–º! üåπ"
- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: "–ï–ª–∏–∑–∞–≤–µ—Ç–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∑"
- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: "[–ò–º—è], –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"
- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—É–∂–æ–µ –∏–º—è (–µ—Å–ª–∏ —É—á–µ–Ω–∏—Ü–∞ –°–≤–µ—Ç–ª–∞–Ω–∞, –Ω–µ –ø–∏—Å–∞—Ç—å "–ï–ª–∏–∑–∞–≤–µ—Ç–∞")

**–ï–°–õ–ò –∏–º—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ:**
- "–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏" (–±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ –∏–º–µ–Ω–∏)'''

    text = text.replace(old_name_section, new_name_section)

    # ===== 2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –®–ê–ì–ê 1: –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å + –ò–º—è + –≠–º–æ–¥–∑–∏ =====

    old_step1 = '''#### –®–ê–ì 1: –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å + –ò–º—è + –≠–º–æ–¥–∑–∏

**–§–æ—Ä–º–∞—Ç**:
```
[–ò–º—è], –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! [—ç–º–æ–¥–∑–∏]
```

**–ü—Ä–∏–º–µ—Ä—ã**:
- "–°–≤–µ—Ç–ª–∞–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –í–∞—Å –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º –≤ –Ω–∞—à–µ–º —á–∞—Ç–µ! üå∑"
- "–¢–∞—Ç—å—è–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –º–æ–∑–≥–æ—Ä–∏—Ç–º! üåπ"
- "–ú–∞—Ä–∏—è, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"'''

    new_step1 = '''#### –®–ê–ì 1: –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å + –ò–º—è + –≠–º–æ–¥–∑–∏

**–§–æ—Ä–º–∞—Ç** (–∏—Å–ø–æ–ª—å–∑—É–π –†–ï–ê–õ–¨–ù–û–ï –∏–º—è —É—á–µ–Ω–∏—Ü—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞):
```
{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! {—ç–º–æ–¥–∑–∏}
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- "–°–≤–µ—Ç–ª–∞–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –í–∞—Å –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º –≤ –Ω–∞—à–µ–º —á–∞—Ç–µ! üå∑"
- "–¢–∞—Ç—å—è–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –º–æ–∑–≥–æ—Ä–∏—Ç–º! üåπ"
- "–ï–ª–∏–∑–∞–≤–µ—Ç–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"
- "–ú–∞—Ä–∏—è, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üåº"

**–í–ê–ñ–ù–û:**
- {–∏–º—è_—É—á–µ–Ω–∏—Ü—ã} ‚Äî placeholder. –ü–æ–¥—Å—Ç–∞–≤—å –†–ï–ê–õ–¨–ù–û–ï –∏–º—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞!
- –ï—Å–ª–∏ –∫—É—Ä–∞—Ç–æ—Ä –Ω–∞–ø–∏—Å–∞–ª "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∑–≥–æ—Ä–∏—Ç–º –ï–ª–∏–∑–∞–≤–µ—Ç—ã" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π "–ï–ª–∏–∑–∞–≤–µ—Ç–∞"
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –±—É–∫–≤–∞–ª—å–Ω–æ "[–ò–º—è]" –∏–ª–∏ "{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}" –≤ –æ—Ç–≤–µ—Ç–µ!'''

    text = text.replace(old_step1, new_step1)

    # ===== 3. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–£–ù–ö–¢–£–ê–¶–ò–ò "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã" =====

    old_example4 = '''**–û—Ç–≤–µ—Ç**:
```
–°–≤–µ—Ç–ª–∞–Ω–∞, –ø—Ä–æ–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ 7 –ø—É–Ω–∫—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:
7. –ß—Ç–æ —è –º–æ–≥–ª–∞ –±—ã –¥–µ–ª–∞—Ç—å –∏ –∫–∞–∫ –ø–æ—Å—Ç—É–ø–∞—Ç—å, —á—Ç–æ–±—ã –º–Ω–µ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ –±–æ–ª—å–Ω–æ –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?
–ù–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å —Å —Ñ—Ä–∞–∑—ã: ¬´–ï—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã...¬ª, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –æ—Å–æ–∑–Ω–∞–≤–∞–ª–∞, —á—Ç–æ —Ç–µ—Ä–∑–∞—è —Å–µ–±—è –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏, –¥–µ–ª–∞—é —Ö—É–∂–µ —Ç–æ–ª—å–∫–æ —Å–µ–±–µ;
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —Å—ä–µ–¥–∞—Ç—å —Å–µ–±—è –≥–æ—Ä–µ—á—å—é —É—Ç—Ä–∞—Ç—ã;
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –º–æ–≥–ª–∞ —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –∏ –ø—Ä–∏–Ω—è—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥ —Å–æ–±—ã—Ç–∏–π.
```'''

    new_example4 = '''**–û—Ç–≤–µ—Ç**:
```
–°–≤–µ—Ç–ª–∞–Ω–∞, –ø—Ä–æ–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ 7 –ø—É–Ω–∫—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:
7. –ß—Ç–æ —è –º–æ–≥–ª–∞ –±—ã –¥–µ–ª–∞—Ç—å –∏ –∫–∞–∫ –ø–æ—Å—Ç—É–ø–∞—Ç—å, —á—Ç–æ–±—ã –º–Ω–µ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ –±–æ–ª—å–Ω–æ –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?
–ù–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å —Å —Ñ—Ä–∞–∑—ã: ¬´–ï—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã...¬ª, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –æ—Å–æ–∑–Ω–∞–≤–∞–ª–∞, —á—Ç–æ —Ç–µ—Ä–∑–∞—è —Å–µ–±—è –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏, –¥–µ–ª–∞—é —Ö—É–∂–µ —Ç–æ–ª—å–∫–æ —Å–µ–±–µ;
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —Å—ä–µ–¥–∞—Ç—å —Å–µ–±—è –≥–æ—Ä–µ—á—å—é —É—Ç—Ä–∞—Ç—ã;
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –º–æ–≥–ª–∞ —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –∏ –ø—Ä–∏–Ω—è—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥ —Å–æ–±—ã—Ç–∏–π.
```

**–í–ê–ñ–ù–û! –ü–†–ê–í–ò–õ–ê –ü–£–ù–ö–¢–£–ê–¶–ò–ò –¥–ª—è "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã":**
- –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è **–¢–û–ß–ö–û–ô –° –ó–ê–ü–Ø–¢–û–ô (;)**
- –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—É–Ω–∫—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è **–¢–û–ß–ö–û–ô (.)**
- –í—Å–µ –ø—É–Ω–∫—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å **–º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã**
- –§–æ—Ä–º–∞—Ç: `- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–¥–µ–π—Å—Ç–≤–∏–µ};` (–¥–µ—Ñ–∏—Å, –ø—Ä–æ–±–µ–ª, –º–∞–ª–µ–Ω—å–∫–∞—è –±—É–∫–≤–∞)'''

    text = text.replace(old_example4, new_example4)

    # ==== 4. –î–û–ë–ê–í–õ–ï–ù–ò–ï –†–ê–ó–î–ï–õ–ê –ü–†–û –ê–ù–ê–õ–ò–ó –ü–£–ù–ö–¢–û–í 1 –ò 2 –ú–û–ó–ì–û–†–ò–¢–ú–ê =====

    # –ù–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª ### –≠–¢–ê–ü 3: –ê–ù–ê–õ–ò–ó –ú–û–ó–ì–û–†–ò–¢–ú–ê –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥—Ä–∞–∑–¥–µ–ª
    analysis_section = '''### –≠–¢–ê–ü 3: –ê–ù–ê–õ–ò–ó –ú–û–ó–ì–û–†–ò–¢–ú–ê (–µ—Å–ª–∏ request_type == "–º–æ–∑–≥–æ—Ä–∏—Ç–º")

```python
# 3.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—à–µ—Å—Ç–∏—à–∞–≥–æ–≤–∞—è –∏–ª–∏ –¥—Ä—É–≥–∞—è)'''

    new_analysis_section = '''### –≠–¢–ê–ü 3: –ê–ù–ê–õ–ò–ó –ú–û–ó–ì–û–†–ò–¢–ú–ê (–µ—Å–ª–∏ request_type == "–º–æ–∑–≥–æ—Ä–∏—Ç–º")

**–ö–†–ò–¢–ò–ß–ù–û! –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã":**

```python
# 3.0. –ê–ù–ê–õ–ò–ó –ö–û–ù–¢–ï–ö–°–¢–ê (–ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏!)
context_analysis = {
    "punkt_1": extract_punkt_1(–º–æ–∑–≥–æ—Ä–∏—Ç–º_—Ç–µ–∫—Å—Ç),  # –ñ–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    "punkt_2": extract_punkt_2(–º–æ–∑–≥–æ—Ä–∏—Ç–º_—Ç–µ–∫—Å—Ç),  # –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
}

# –ü—É–Ω–∫—Ç 1: –ß—Ç–æ —è —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å? (–ñ–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
# –ü—Ä–∏–º–µ—Ä: "–•–æ—á—É —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ"
# ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω—ã –≤–µ—Å—Ç–∏ –ö —ç—Ç–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

# –ü—É–Ω–∫—Ç 2: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å? (–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è)
# –ü—Ä–∏–º–µ—Ä: "–Ø –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ç—Ä–µ–≤–æ–∂—É—Å—å –∏ –∑–∞–µ–¥–∞—é —Å—Ç—Ä–µ—Å—Å —à–æ–∫–æ–ª–∞–¥–æ–º"
# ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å –≠–¢–£ —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é

# –í–ê–ñ–ù–û –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã":
# - –û–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –ø—É–Ω–∫—Ç 1 (–∫ –∫–∞–∫–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–¥—ë–º)
# - –û–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –ø—É–Ω–∫—Ç 2 (–∏–∑ –∫–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–∏–º)
# - –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –í –ö–û–ù–¢–ï–ö–°–¢–ï —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —É—á–µ–Ω–∏—Ü—ã
# - –ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã ("–º–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å", "–∑–∞–Ω–∏–º–∞—Ç—å—Å—è –π–æ–≥–æ–π")
#   –µ—Å–ª–∏ —É—á–µ–Ω–∏—Ü–∞ –æ –Ω–∏—Ö –Ω–µ –ø–∏—Å–∞–ª–∞!

# –ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ô –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
# –ü—É–Ω–∫—Ç 1: "–•–æ—á—É –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –∑–∞–µ–¥–∞—Ç—å —Å—Ç—Ä–µ—Å—Å"
# –ü—É–Ω–∫—Ç 2: "–ö–æ–≥–¥–∞ –≤–æ–ª–Ω—É—é—Å—å, –µ–º —à–æ–∫–æ–ª–∞–¥ –∏ –ø–µ—á–µ–Ω—å–µ"
# ‚Üí "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –æ—Å–æ–∑–Ω–∞–≤–∞–ª–∞, —á—Ç–æ —à–æ–∫–æ–ª–∞–¥ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É"
# ‚Üí "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –µ—Å—Ç—å –ø–µ—á–µ–Ω—å–µ –∫–æ–≥–¥–∞ –≤–æ–ª–Ω—É—é—Å—å"
#
# –ù–ï:
# ‚Üí "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –Ω–∞—á–∞–ª–∞ –º–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å" (—É—á–µ–Ω–∏—Ü–∞ –Ω–µ –ø–∏—Å–∞–ª–∞ –ø—Ä–æ –º–µ–¥–∏—Ç–∞—Ü–∏—é!)
# ‚Üí "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã –ø–æ—à–ª–∞ –Ω–∞ –π–æ–≥—É" (–æ—Ç–∫—É–¥–∞ —ç—Ç–æ –≤–∑—è–ª–æ—Å—å?)
```

```python
# 3.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—à–µ—Å—Ç–∏—à–∞–≥–æ–≤–∞—è –∏–ª–∏ –¥—Ä—É–≥–∞—è)'''

    text = text.replace(analysis_section, new_analysis_section)

    # ===== 5. –ó–ê–ú–ï–ù–ê –í–°–ï–• –û–°–¢–ê–í–®–ò–•–°–Ø PLACEHOLDER [–ò–º—è] =====

    # –ó–∞–º–µ–Ω–∏—Ç—å [–ò–º—è] –Ω–∞ {–∏–º—è_—É—á–µ–Ω–∏—Ü—ã} —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º (–ù–ï –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –∫–æ–¥–∞!)
    def replace_name_placeholder(match):
        full_match = match.group(0)
        # –ù–µ –∑–∞–º–µ–Ω—è—Ç—å –≤–Ω—É—Ç—Ä–∏ code blocks
        return full_match  # –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å –≤ code blocks

    # –ó–∞–º–µ–Ω—è–µ–º [–ò–º—è] –≤–Ω–µ code blocks
    lines = text.split('\n')
    fixed_lines = []
    in_code_block = False

    for line in lines:
        if line.strip().startswith('```'):
            in_code_block = not in_code_block

        # –ó–∞–º–µ–Ω—è—Ç—å [–ò–º—è] —Ç–æ–ª—å–∫–æ –≤–Ω–µ code blocks
        if not in_code_block and '[–ò–º—è]' in line:
            # –ó–∞–º–µ–Ω–∏—Ç—å –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
            line = line.replace('[–ò–º—è]', '{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}')

        fixed_lines.append(line)

    text = '\n'.join(fixed_lines)

    return text

def main():
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å instruction.json
    with open('data/instruction.json', 'r', encoding='utf-8') as f:
        data = json.load(f)

    # –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    original_text = data['system_instruction']
    fixed_text = fix_instruction_text(original_text)

    # –û–±–Ω–æ–≤–∏—Ç—å JSON
    data['system_instruction'] = fixed_text
    data['last_updated'] = '2025-11-18T16:30:00.000000'

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª
    with open('data/instruction.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print("‚úÖ –§–∞–π–ª data/instruction.json –æ–±–Ω–æ–≤–ª—ë–Ω!")
    print(f"üìä –î–ª–∏–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: {len(fixed_text)} —Å–∏–º–≤–æ–ª–æ–≤")
    print(f"üìù –ó–∞–º–µ–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:")
    print(f"  - –†–∞–∑–¥–µ–ª –ø—Ä–æ –∏–º—è: –æ–±–Ω–æ–≤–ª—ë–Ω")
    print(f"  - –®–ê–ì 1 (–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å): –æ–±–Ω–æ–≤–ª—ë–Ω")
    print(f"  - –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è '–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã': –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞")
    print(f"  - –†–∞–∑–¥–µ–ª –∞–Ω–∞–ª–∏–∑–∞ –ø—É–Ω–∫—Ç–æ–≤ 1 –∏ 2: –¥–æ–±–∞–≤–ª–µ–Ω")
    print(f"  - Placeholders [–ò–º—è]: –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ {{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}}")

if __name__ == '__main__':
    main()
