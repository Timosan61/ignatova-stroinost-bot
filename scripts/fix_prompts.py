#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Promts —Ñ–∞–π–ª–æ–≤ (.md)
–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–µ –∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á—Ç–æ –∏ –≤ instruction.json
"""

import re

def fix_prompt_file(filepath: str):
    """–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç Promts —Ñ–∞–π–ª"""

    with open(filepath, 'r', encoding='utf-8') as f:
        text = f.read()

    # ===== 1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï PLACEHOLDER [–ò–º—è] =====

    # –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å placeholder
    text = text.replace(
        '**–í–°–ï–ì–î–ê** –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏: "[–ò–º—è], –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"',
        '**–í–°–ï–ì–î–ê** –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏ —É—á–µ–Ω–∏—Ü—ã (–∏–∑–≤–ª–µ–∫–∞–π –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞!):\n- "–°–≤–µ—Ç–ª–∞–Ω–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏"\n- "–ï–ª–∏–∑–∞–≤–µ—Ç–∞, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∑"'
    )

    text = text.replace(
        '[–ò–º—è], –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏',
        '{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}, –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –º–æ–∑–≥–æ—Ä–∏—Ç–º! üå∏\n\n**–í–ê–ñ–ù–û:** {–∏–º—è_—É—á–µ–Ω–∏—Ü—ã} - placeholder! –ò–∑–≤–ª–µ–∫–∞–π –†–ï–ê–õ–¨–ù–û–ï –∏–º—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞:\n- "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∑–≥–æ—Ä–∏—Ç–º –ï–ª–∏–∑–∞–≤–µ—Ç—ã" ‚Üí –ï–ª–∏–∑–∞–≤–µ—Ç–∞\n- "–ü–æ–º–æ–≥–∏ –°–≤–µ—Ç–ª–∞–Ω–µ" ‚Üí –°–≤–µ—Ç–ª–∞–Ω–∞'
    )

    text = text.replace(
        '[–ò–º—è], –æ—Ç–≤–µ—á–∞—é –Ω–∞ –í–∞—à –≤–æ–ø—Ä–æ—Å üå∑',
        '{–∏–º—è_—É—á–µ–Ω–∏—Ü—ã}, –æ—Ç–≤–µ—á–∞—é –Ω–∞ –í–∞—à –≤–æ–ø—Ä–æ—Å üå∑\n**–í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–π –†–ï–ê–õ–¨–ù–û–ï –∏–º—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞!'
    )

    # ===== 2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–£–ù–ö–¢–£–ê–¶–ò–ò "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã" =====

    old_list_pattern = '''–í –ø—É–Ω–∫—Ç–µ 4 –º–æ–∂–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç—å:
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 1];
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 2];
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 3];
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 4];
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 5];
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã [–ø—Ä–∏–º–µ—Ä 6].'''

    new_list_pattern = '''–í –ø—É–Ω–∫—Ç–µ 4 –º–æ–∂–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç—å:
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ};
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ};
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ};
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ};
- –µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã {–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ}.

**–ü–†–ê–í–ò–õ–ê:**
- –î–µ—Ñ–∏—Å, –ø—Ä–æ–±–µ–ª, –º–∞–ª–µ–Ω—å–∫–∞—è –±—É–∫–≤–∞
- –¢–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π (;) –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞
- –¢–æ—á–∫–∞ (.) –¢–û–õ–¨–ö–û –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø—É–Ω–∫—Ç–µ
- –û–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –ø—É–Ω–∫—Ç—ã 1 –∏ 2 –º–æ–∑–≥–æ—Ä–∏—Ç–º–∞ —É—á–µ–Ω–∏—Ü—ã!'''

    text = text.replace(old_list_pattern, new_list_pattern)

    # ===== 3. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–†–û –ö–û–ù–¢–ï–ö–°–¢ –ú–û–ó–ì–û–†–ò–¢–ú–ê =====

    # –ù–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏" –∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    if '**3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏** (–ö–†–ò–¢–ò–ß–ù–û!)' in text:
        old_rec_section = '**3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏** (–ö–†–ò–¢–ò–ß–ù–û!)'
        new_rec_section = '''**3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏** (–ö–†–ò–¢–ò–ß–ù–û!)

**–í–ê–ñ–ù–û! –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π "–µ—Å–ª–∏ –±—ã —è —Ö–æ—Ç—è –±—ã":**

- –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø—É–Ω–∫—Ç 1 –º–æ–∑–≥–æ—Ä–∏—Ç–º–∞ (–∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø—É–Ω–∫—Ç 2 (—Ç–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è)
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ç–æ—Ä—ã–µ –≤–µ–¥—É—Ç –æ—Ç –ø—É–Ω–∫—Ç–∞ 2 –∫ –ø—É–Ω–∫—Ç—É 1
- –î–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–∏—Ç—É–∞—Ü–∏–∏ —É—á–µ–Ω–∏—Ü—ã
- –ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã ("–º–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å", "–π–æ–≥–∞") –µ—Å–ª–∏ —É—á–µ–Ω–∏—Ü–∞ –æ –Ω–∏—Ö –Ω–µ –ø–∏—Å–∞–ª–∞!'''

        text = text.replace(old_rec_section, new_rec_section)

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(text)

    print(f"‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω: {filepath}")

def main():
    files_to_fix = [
        'Promts/SYSTEM_PROMPT_CURATOR_AGENT_SHORT.md',
        'Promts/SYSTEM_PROMPT_CURATOR_AGENT.md'
    ]

    for filepath in files_to_fix:
        print(f"üîß –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é: {filepath}...")
        fix_prompt_file(filepath)

    print("\n‚úÖ –í—Å–µ Promts —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")

if __name__ == '__main__':
    main()
