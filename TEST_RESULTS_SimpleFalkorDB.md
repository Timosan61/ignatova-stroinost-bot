# SimpleFalkorDB - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025
**–¶–µ–ª—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SimpleFalkorDB –∫–∞–∫ –∑–∞–º–µ–Ω—É Graphiti –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å FalkorDB

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

### –ó–∞–≥—Ä—É–∂–µ–Ω–æ entities:
- ‚úÖ **FAQ:** 25/25 (100%)
- ‚úÖ **–£—Ä–æ–∫–∏:** 149/149 (100%)
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:** 275/275 (100%)
- ‚úÖ **–í–°–ï–ì–û:** 449/449 (100%)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞—Ñ–∞ FalkorDB:
- **Total nodes:** 453 (449 –Ω–æ–≤—ã—Ö + 4 —Ç–µ—Å—Ç–æ–≤—ã—Ö)
- **–ü–æ —Ç–∏–ø–∞–º:**
  - `lesson`: 150
  - `faq`: 26
  - `correction`: 275
  - `test`: 2

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏:** ~100ms –Ω–∞ entity
- **–û—à–∏–±–æ–∫:** 0
- **–î—É–±–ª–∏–∫–∞—Ç–æ–≤:** –ù–µ—Ç

---

## üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞

### –¢–µ—Å—Ç 1: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ SimpleFalkorDB

| –ó–∞–ø—Ä–æ—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|--------|------------|--------|
| `–º–æ–∑–≥–æ—Ä–∏—Ç–º` | 3 (lesson + 2 FAQ) | ‚úÖ |
| `–≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è` | 1 (lesson) | ‚úÖ |
| `—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è` | 3 (FAQ + 2 lessons) | ‚úÖ |
| `—Ç–µ—Ö–Ω–∏–∫–∞ –ø—Ä–æ—â–µ–Ω–∏—è` | 0 | ‚ö†Ô∏è –ù–µ—Ç —Ç–æ—á–Ω–æ–≥–æ match |
| `–∫—É—Ä—Å –≤—Å–µ–ø—Ä–æ—â–∞—é—â–∞—è` | 0 | ‚ö†Ô∏è –ù–µ—Ç —Ç–æ—á–Ω–æ–≥–æ match |

**–í—ã–≤–æ–¥:** Fulltext search —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

### –¢–µ—Å—Ç 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KnowledgeSearchService

| –ó–∞–ø—Ä–æ—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | Source | –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å |
|--------|------------|--------|---------------|
| `–º–æ–∑–≥–æ—Ä–∏—Ç–º` | 3 | simple_falkordb_lesson, simple_falkordb_faq | 0.80 |
| `–≤–µ—Å –≤—Å—Ç–∞–ª` | 1 | simple_falkordb_faq | 0.80 |
| `—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è` | 3 | simple_falkordb_faq, simple_falkordb_lesson | 0.80 |
| `6 —à–∞–≥–æ–≤ –ø—Ä–æ—â–µ–Ω–∏—è` | 0 | - | - |
| `—Ç–µ—Ö–Ω–∏–∫–∞ –ø—Ä–æ—â–µ–Ω–∏—è` | 0 | - | - |

**–í—ã–≤–æ–¥:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ SimpleFalkorDB.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **bot/services/simple_falkordb_service.py** (270 —Å—Ç—Ä–æ–∫)
   - Direct FalkorDB connection —á–µ—Ä–µ–∑ `falkordb.asyncio`
   - –ü—Ä—è–º—ã–µ Cypher –∑–∞–ø—Ä–æ—Å—ã —Å string escaping
   - –ú–µ—Ç–æ–¥—ã: `add_text()`, `search_fulltext()`, `health_check()`, `get_stats()`

2. **bot/services/knowledge_search.py** (–æ–±–Ω–æ–≤–ª—ë–Ω)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SimpleFalkorDB
   - Routing: Qdrant ‚Üí SimpleFalkorDB ‚Üí Graphiti ‚Üí Local Files
   - SimpleFalkorDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ `use_simple_falkordb=True`

3. **scripts/load_simple_falkordb.py** (215 —Å—Ç—Ä–æ–∫)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –≤ FalkorDB
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `KnowledgeBaseParser`
   - Batch loading —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º

### Cypher –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ node:**
```cypher
CREATE (n:Knowledge {
    id: '{uuid}',
    content: '{escaped_content}',
    type: '{type}',
    source: '{source}',
    created_at: '{timestamp}'
})
RETURN n.id AS id
```

**Fulltext search (case-insensitive):**
```cypher
MATCH (n:Knowledge)
WHERE toLower(n.content) CONTAINS toLower('{query}')
RETURN n.id, n.content, n.type, n.source, n.created_at
LIMIT {limit}
```

---

## ‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SimpleFalkorDB vs Graphiti

| –ö—Ä–∏—Ç–µ—Ä–∏–π | SimpleFalkorDB | Graphiti |
|----------|----------------|----------|
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | ‚úÖ –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å FalkorDB | ‚ùå Bugs –≤ graphiti-core-falkordb |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏** | ‚úÖ ~100ms/entity | ‚ùå ~500-1000ms/entity (OpenAI calls) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | ‚ùå $2-3 –∑–∞ 449 entities (OpenAI API) |
| **Cypher params** | ‚úÖ String escaping (—Ä–∞–±–æ—Ç–∞–µ—Ç) | ‚ùå Params –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (bug) |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞** | ‚úÖ 270 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ‚ùå 400+ —Å—Ç—Ä–æ–∫ + dependencies |
| **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** | ‚úÖ –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤ | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç OpenAI API |

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Fulltext search —Ç–æ–ª—å–∫–æ:**
   - –ù–µ—Ç semantic search (vector embeddings)
   - –ù–µ—Ç graph traversal (relationships)
   - Case-insensitive CONTAINS —Ç–æ–ª—å–∫–æ

2. **–¢–æ—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã:**
   - "6 —à–∞–≥–æ–≤ –ø—Ä–æ—â–µ–Ω–∏—è" ‚Üí 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–Ω–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ —Ç–æ—á–Ω–æ —Ç–∞–∫)
   - "—à–µ—Å—Ç—å —à–∞–≥–æ–≤" vs "6 —à–∞–≥–æ–≤" ‚Üí –Ω–µ –Ω–∞–π–¥—ë—Ç

3. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:**
   - SimpleFalkorDB –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
   - –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ—á–∏—â–∞—Ç—å –≥—Ä–∞—Ñ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

### ‚úÖ –ì–æ—Ç–æ–≤–æ:
- SimpleFalkorDB —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KnowledgeSearchService —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (449 entities) –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ FalkorDB Cloud
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ

### üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –¥–µ–ø–ª–æ—è:

1. **Railway Environment Variables:**
   ```bash
   GRAPHITI_ENABLED=true
   FALKORDB_HOST=r-6jissuruar.instance-d9hpk5pi4.hc-2uaqqpjgg.us-east-2.aws.f2e0a955bb84.cloud
   FALKORDB_PORT=62403
   FALKORDB_USERNAME=falkordb
   FALKORDB_PASSWORD=cmcFTOFfEiSj
   FALKORDB_DATABASE=knowledge_graph
   USE_QDRANT=false  # –û—Ç–∫–ª—é—á–∏—Ç—å Qdrant, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ FalkorDB
   ```

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–∞ production:**
   - –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∑–∞–ø—É—Å—Ç–∏—Ç—å: `python3 scripts/load_simple_falkordb.py` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Admin API endpoint (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º)

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - Health check: `/health`
   - Stats: –î–æ–±–∞–≤–∏—Ç—å endpoint `/api/admin/falkordb/stats`

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. `bot/services/simple_falkordb_service.py` - SimpleFalkorDB —Å–µ—Ä–≤–∏—Å
2. `scripts/load_simple_falkordb.py` - –ó–∞–≥—Ä—É–∑—á–∏–∫ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
3. `scripts/test_simple_falkordb.py` - –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
4. `test_simple_knowledge_search.py` - –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `bot/services/knowledge_search.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SimpleFalkorDB
2. `bot/config.py` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω default FALKORDB_USERNAME
3. `.env` - –û–±–Ω–æ–≤–ª–µ–Ω—ã FalkorDB credentials

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è production:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SimpleFalkorDB –≤–º–µ—Å—Ç–æ Graphiti:**
   - –ü—Ä–æ—â–µ, –±—ã—Å—Ç—Ä–µ–µ, –¥–µ—à–µ–≤–ª–µ
   - –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç OpenAI API
   - –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å FalkorDB –±–µ–∑ bugs

2. **–î–æ–±–∞–≤–∏—Ç—å Admin API endpoints:**
   ```python
   POST /api/admin/falkordb/load  # –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
   GET /api/admin/falkordb/stats  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞—Ñ–∞
   POST /api/admin/falkordb/clear # –û—á–∏—Å—Ç–∫–∞ –≥—Ä–∞—Ñ–∞
   ```

3. **–£–ª—É—á—à–∏—Ç—å –ø–æ–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –î–æ–±–∞–≤–∏—Ç—å fuzzy matching (Levenshtein distance)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ ("6" = "—à–µ—Å—Ç—å")
   - Ranking results –ø–æ —á–∞—Å—Ç–æ—Ç–µ keywords

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - Metrics: search latency, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, empty searches
   - Dashboard: —Ç–æ–ø queries, —á–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## ‚úÖ –í—ã–≤–æ–¥—ã

**SimpleFalkorDB –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (449 entities)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KnowledgeSearchService —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ –±–ª–æ–∫–µ—Ä–æ–≤

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** Commit –∏ deploy –Ω–∞ Railway (–ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
